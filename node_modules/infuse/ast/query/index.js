
var Proteus = require("proteus"),
    queryParser = new (require("./parser"))()
;

/**
 * Very basic query handling at this time.
 * 
 * The interface provides a way to expand this later.
 */
module.exports = Proteus.Class.derive({
    /**
     * @constructor
     * @param {String} query the rule, or rules to parse.
     */
    init: function (query) {
        this.source = query;
        this.rules = queryParser.parse(query);
    },
    /**
     * @method test
     * @param {Object} node node-wrapper instance
     * @returns {Boolean} whether or not this query matched the node-wrapper
     */
    test: function (node) {
        return this.rules.some(function (rule) {
            return rule.test(node);
        });
    }
    
});
