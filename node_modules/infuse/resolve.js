
var resolveIt   = require('resolveit'),
    nodePath    = process.env.NODE_PATH,
    nodePaths   = nodePath && nodePath.split(':'),
    isArray     = Array.isArray,
    resolveOpts = {
        silent: true,
        index: ['index', 'main', 'package'],
        extension: ['js', 'node', 'json'],
        packages: ['package.json']
    };
/**
 * @param {String} name name or path to resolve
 * @param {String} basepath optional, the base directory path to start from
 * @param {Array} nodelib optional, the list of node library directories to
 *      search for core modules.
 * @returns {String} path to the module
 * @throws {Error} if the name can not be resolved
 */
module.exports = function (name, basepath, nodelib) {
    var paths, path, msg;
    
    paths = isArray(basepath) ? basepath :
        typeof basepath !== 'undefined' ? [basepath] : [];
    
    paths.concat([nodelib, nodePaths].filter(Boolean));
    
    path = resolveIt.sync(name, paths, resolveOpts);
    if (!path) {
        msg = 'Could not resolve \'' + name + '\' in ' + paths.join(', ');
        throw new Error(msg);
    }
    
    return path;
};

